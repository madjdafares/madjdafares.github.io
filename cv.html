<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Madjda Fares | CV</title>

  <style>
    :root{
      --bg:#050505;
      --text:rgba(255,255,255,0.92);
      --muted:rgba(205,205,205,0.68);

      --amber:#ff9a3d;
      --shadow:0 18px 55px rgba(0,0,0,0.60);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:var(--bg);
      overflow-x:hidden;
    }

    body::before{
      content:"";
      position:fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      background:
        radial-gradient(900px 420px at 14% 0%, rgba(255,154,61,0.07), transparent 70%),
        radial-gradient(900px 420px at 88% 0%, rgba(77,163,255,0.06), transparent 72%),
        radial-gradient(900px 520px at 22% 100%, rgba(41,255,138,0.05), transparent 74%),
        radial-gradient(900px 520px at 90% 100%, rgba(255,211,77,0.04), transparent 76%),
        radial-gradient(700px 350px at 50% 50%, rgba(255,59,92,0.02), transparent 70%);
      background-repeat:no-repeat;
      background-size:cover;
    }

    a{ color:inherit; text-decoration:none; }
    a:hover{ color:var(--amber); }

    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      height:58px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 18px;
      backdrop-filter:blur(14px);
      background:linear-gradient(180deg, rgba(5,5,5,0.92), rgba(5,5,5,0.62));
      border-bottom:1px solid rgba(255,255,255,0.07);
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:220px;
    }
    .brand h1{ font-size:14px; margin:0; letter-spacing:0.3px; }
    .brand .sub{ font-size:12px; color:var(--muted); font-family:var(--mono); }

    .cta{ display:flex; gap:10px; align-items:center; }
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:9px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.04);
      color:var(--text);
      font-size:12px;
      transition:160ms ease;
      white-space:nowrap;
    }
    .btn:hover{
      transform:translateY(-1px);
      border-color:rgba(255,154,61,0.35);
      box-shadow:0 0 0 1px rgba(255,154,61,0.08), 0 0 22px rgba(255,154,61,0.10);
    }
    .btn.primary{
      border-color:rgba(255,154,61,0.40);
      background:linear-gradient(135deg, rgba(255,154,61,0.16), rgba(255,211,77,0.07));
    }

    .viewer{ padding:18px 0 40px; }
    .pages{
      width:min(1100px, 94vw);
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .page{ display:flex; justify-content:center; }
    canvas{
      display:block;
      background:#fff;
      box-shadow:var(--shadow);
      border-radius:10px;
      max-width:100%;
      height:auto;
    }

    .status{
      width:min(1100px, 94vw);
      margin:12px auto 0;
      font-family:var(--mono);
      font-size:12px;
      color:rgba(205,205,205,0.72);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .err{ color:rgba(255,120,140,0.95); }
    code{ font-family:var(--mono); }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <h1>Madjda Fares</h1>
      <div class="sub">Curriculum Vitae</div>
    </div>

    <div class="cta">
      <a class="btn" href="index.html">Back</a>
      <a class="btn primary" href="MadjdaFares_cv.pdf" download>Download CV</a>
    </div>
  </header>

  <main class="viewer">
    <div class="pages" id="pages"></div>
    <div class="status">
      <div id="msg">Loading…</div>
      <div id="meta"></div>
    </div>
  </main>

  <script src="./lib/pdfjs/pdf.min.js"></script>

  <script>
    const PDF_URL  = "./MadjdaFares_cv.pdf";
    const CMAP_URL = "./lib/pdfjs/cmaps/";
    const FONT_URL = "./lib/pdfjs/standard_fonts/";

    const pagesEl = document.getElementById("pages");
    const msgEl   = document.getElementById("msg");
    const metaEl  = document.getElementById("meta");

    function clearPages(){ pagesEl.innerHTML = ""; }

    function makeCanvasWrap(){
      const wrap = document.createElement("div");
      wrap.className = "page";
      const canvas = document.createElement("canvas");
      wrap.appendChild(canvas);
      pagesEl.appendChild(wrap);
      return canvas;
    }

    function fitScale(page){
      const v1 = page.getViewport({ scale: 1 });
      const w = pagesEl.getBoundingClientRect().width || 900;
      const scaleW = w / v1.width;

      const maxH = Math.max(520, window.innerHeight - 140);
      const scaleH = maxH / v1.height;

      return Math.min(scaleW, scaleH);
    }

    function canvasLooksBlank(ctx, w, h){
      // sample a grid, don’t read the whole image (fast)
      const samplesX = 12, samplesY = 16;
      for(let y = 1; y < samplesY; y++){
        for(let x = 1; x < samplesX; x++){
          const px = Math.floor((x / samplesX) * w);
          const py = Math.floor((y / samplesY) * h);
          const d = ctx.getImageData(px, py, 1, 1).data;
          // if any pixel is not almost-white, we have content
          if(d[0] < 245 || d[1] < 245 || d[2] < 245) return false;
        }
      }
      return true;
    }

    async function renderAll(pdfDoc){
      clearPages();
      msgEl.textContent = "Rendering…";

      for(let i = 1; i <= pdfDoc.numPages; i++){
        const page = await pdfDoc.getPage(i);
        const scale = fitScale(page);
        const viewport = page.getViewport({ scale });

        const outputScale = window.devicePixelRatio || 1;

        const canvas = makeCanvasWrap();
        const ctx = canvas.getContext("2d");

        canvas.width  = Math.floor(viewport.width * outputScale);
        canvas.height = Math.floor(viewport.height * outputScale);
        canvas.style.width  = Math.floor(viewport.width) + "px";
        canvas.style.height = Math.floor(viewport.height) + "px";

        // paint paper into pixels (not just CSS)
        ctx.setTransform(1,0,0,1,0,0);
        ctx.fillStyle = "#ffffff";
        ctx.fillRect(0,0,canvas.width,canvas.height);

        const transform = outputScale !== 1 ? [outputScale, 0, 0, outputScale, 0, 0] : null;

        await page.render({
          canvasContext: ctx,
          viewport,
          transform
        }).promise;

        // If first page renders all-white, warn in UI
        if(i === 1){
          const blank = canvasLooksBlank(ctx, canvas.width, canvas.height);
          if(blank){
            msgEl.innerHTML = `<span class="err">Rendered, but page pixels are blank.</span>`;
          }
        }
      }

      if(!msgEl.innerHTML.includes("Rendered, but")){
        msgEl.textContent = "Done.";
      }
    }

    async function fetchPdfBytes(url){
      const res = await fetch(url, { cache: "no-store" });
      if(!res.ok) throw new Error(`PDF fetch failed: ${res.status} ${res.statusText}`);
      return await res.arrayBuffer();
    }

    (async function boot(){
      try{
        const pdfjsLib = window.pdfjsLib;
        if(!pdfjsLib){
          msgEl.innerHTML = `<span class="err">PDF.js did not load.</span>`;
          metaEl.textContent = "Check ./lib/pdfjs/pdf.min.js";
          return;
        }

        // Most compatible mode
        pdfjsLib.disableWorker = true;

        msgEl.textContent = "Fetching PDF…";
        const bytes = await fetchPdfBytes(PDF_URL);

        msgEl.textContent = "Parsing PDF…";
        const loadingTask = pdfjsLib.getDocument({
          data: bytes,
          cMapUrl: CMAP_URL,
          cMapPacked: true,
          standardFontDataUrl: FONT_URL,
          disableFontFace: true,
          useSystemFonts: true
        });

        const pdfDoc = await loadingTask.promise;
        metaEl.textContent = `${pdfDoc.numPages} page(s)`;

        // Quick proof: does PDF.js even see text on page 1?
        

        await renderAll(pdfDoc);

        let t = null;
        window.addEventListener("resize", () => {
          clearTimeout(t);
          t = setTimeout(() => renderAll(pdfDoc), 180);
        });

      }catch(e){
        console.error(e);
        msgEl.innerHTML = `<span class="err">${String(e.message || e)}</span>`;
        metaEl.textContent = "Open DevTools Console for details.";
      }
    })();
  </script>
</body>
</html>
